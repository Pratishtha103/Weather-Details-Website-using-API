<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <style>
        body{
            margin:0;
            padding:0;
            height:100vh;
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: url('https://images.unsplash.com/photo-1464427219274-ab9450eba98b?q=80&w=1273&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            display:flex;
            justify-content: center;
            align-items: center;
        }
        .container{
            height:350px;
            max-width:300px;
            background-color: black;
            opacity:0.75;
            border-radius: 15px;
            align-items:center;
            justify-content: center;
            padding-top: 20px;
        }
        .autocomplete-container{
            position: relative;
            display: flex;
            justify-content:center;
            align-items: center;
            gap:5px;
        }
        .country{
            background-color:rgb(44, 44, 44);
            border:none;
            border-radius:20px;
            height:30px;
            width:225px;
            color: white;
            padding-left: 15px;
            font-size: 16px;
        }
        .country:hover{
            background-color: white;
            color: black;
        }
        .search-button{
            background-color:rgb(44, 44, 44);
            color:gray;
            border: none;
            border-radius:50%;
            height:32px;
            width:32px;
        }
        .search-button:hover{
            background-color:white;
            color:black;
        }
        h1{ 
            text-align: center;
        }
        #heading{
            color:whitesmoke;
            text-align: center;
        }
        .weather-details{
            height:120px;
            width:270px;
            text-align: center;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="autocomplete-container">
            <!-- Autocomplete Dropdown -->
            <input type="text" id="country" class ="country" placeholder="Search a Country" list ="countries" autocomplete="on" required>
            <datalist id="countries">
                <option value="Afghanistan">
                <option value="Albania">
                <option value="Algeria">
                <option value="Andorra">
                <option value="Angola">
                <option value="Argentina">
                <option value="Armenia">
                <option value="Australia">
                <option value="Austria">
                <option value="Azerbaijan">
                <option value="Bahamas">
                <option value="Bahrain">
                <option value="Bangladesh">
                <option value="Barbados">
                <option value="Belarus">
                <option value="Belgium">
                <option value="Belize">
                <option value="Benin">
                <option value="Bhutan">
                <option value="Bolivia">
                <option value="Bosnia and Herzegovina">
                <option value="Botswana">
                <option value="Brazil">
                <option value="Brunei">
                <option value="Bulgaria">
                <option value="Burkina Faso">
                <option value="Burundi">
                <option value="Cambodia">
                <option value="Cameroon">
                <option value="Canada">
                <option value="Chad">
                <option value="Chile">
                <option value="China">
                <option value="Colombia">
                <option value="Comoros">
                <option value="Costa Rica">
                <option value="Croatia">
                <option value="Cuba">
                <option value="Cyprus">
                <option value="Czech Republic">
                <option value="Denmark">
                <option value="Djibouti">
                <option value="Dominica">
                <option value="Dominican Republic">
                <option value="Ecuador">
                <option value="Egypt">
                <option value="El Salvador">
                <option value="Estonia">
                <option value="Eswatini">
                <option value="Ethiopia">
                <option value="Fiji">
                <option value="Finland">
                <option value="France">
                <option value="Gabon">
                <option value="Gambia">
                <option value="Georgia">
                <option value="Germany">
                <option value="Ghana">
                <option value="Greece">
                <option value="Guatemala">
                <option value="Guinea">
                <option value="Guyana">
                <option value="Haiti">
                <option value="Honduras">
                <option value="Hungary">
                <option value="Iceland">
                <option value="India">
                <option value="Indonesia">
                <option value="Iran">
                <option value="Iraq">
                <option value="Ireland">
                <option value="Israel">
                <option value="Italy">
                <option value="Jamaica">
                <option value="Japan">
                <option value="Jordan">
                <option value="Kazakhstan">
                <option value="Kenya">
                <option value="Kuwait">
                <option value="Kyrgyzstan">
                <option value="Laos">
                <option value="Latvia">
                <option value="Lebanon">
                <option value="Lesotho">
                <option value="Liberia">
                <option value="Libya">
                <option value="Lithuania">
                <option value="Luxembourg">
                <option value="Madagascar">
                <option value="Malawi">
                <option value="Malaysia">
                <option value="Maldives">
                <option value="Mali">
                <option value="Malta">
                <option value="Mauritania">
                <option value="Mauritius">
                <option value="Mexico">
                <option value="Moldova">
                <option value="Monaco">
                <option value="Mongolia">
                <option value="Montenegro">
                <option value="Morocco">
                <option value="Mozambique">
                <option value="Myanmar">
                <option value="Namibia">
                <option value="Nepal">
                <option value="Netherlands">
                <option value="New Zealand">
                <option value="Nicaragua">
                <option value="Niger">
                <option value="Nigeria">
                <option value="North Korea">
                <option value="North Macedonia">
                <option value="Norway">
                <option value="Oman">
                <option value="Pakistan">
                <option value="Panama">
                <option value="Paraguay">
                <option value="Peru">
                <option value="Philippines">
                <option value="Poland">
                <option value="Portugal">
                <option value="Qatar">
                <option value="Romania">
                <option value="Russia">
                <option value="Rwanda">
                <option value="Saudi Arabia">
                <option value="Senegal">
                <option value="Serbia">
                <option value="Seychelles">
                <option value="Singapore">
                <option value="Slovakia">
                <option value="Slovenia">
                <option value="Somalia">
                <option value="South Africa">
                <option value="South Korea">
                <option value="Spain">
                <option value="Sri Lanka">
                <option value="Sudan">
                <option value="Sweden">
                <option value="Switzerland">
                <option value="Syria">
                <option value="Taiwan">
                <option value="Tajikistan">
                <option value="Tanzania">
                <option value="Thailand">
                <option value="Togo">
                <option value="Trinidad and Tobago">
                <option value="Tunisia">
                <option value="Turkey">
                <option value="Turkmenistan">
                <option value="Uganda">
                <option value="Ukraine">
                <option value="UAE">
                <option value="UK">
                <option value="USA">
                <option value="Uruguay">
                <option value="Uzbekistan">
                <option value="Venezuela">
                <option value="Vietnam">
                <option value="Yemen">
                <option value="Zambia">
                <option value="Zimbabwe">
            </datalist>
            <!-- Search Button -->
            <button class="search-button" onclick="handleSearch()">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-search" viewBox="0 0 15 20">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                </svg>
            </button>
        </div>
        <br>
        <h1>üå¶Ô∏è</h1>
        <h2 id="heading">Weather Details</h2>
        <div id="weatherDetails" class="weather-details"></div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script>
        //get the elements
        const input = document.getElementById('country');
        const list = document.getElementById('autocompleteList');
        
        //weather details using latitude and longtitude, open weather map api
        async function weather(lat, lng, country){
            const api2 = 'YOUR_OPENWEATHERMAP_API_KEY';
            const urlTwo = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${api2}&units=metric`;
            try{
                const responseTwo = await fetch(urlTwo);
                //console.log(responseTwo);
                if(responseTwo.ok){
                    const dataTwo = await responseTwo.json();
                    //console.log("Full response:", dataTwo);
                    const temp = dataTwo.main.temp;
                    const detail = dataTwo.weather[0].description;
                    const details = detail.toUpperCase();
                    const humidity = dataTwo.main.humidity;
                    const windSpeed = dataTwo.wind.speed;
                    // console.log(dataTwo.name);
                    // console.log(temp);
                    // console.log(details);
                    // console.log(humidity);
                    // console.log(windSpeed);

                    //get elements to update
                    const heading = document.getElementById('heading');
                    const weatherDetails = document.getElementById('weatherDetails');
                    heading.textContent =`Weather in ${country}`;
                    weatherDetails.innerHTML= `
                    <div>
                        <h2>${temp}&deg;C</h2>
                        <p>&#9729; ${details}<br>
                        Humidity: ${humidity}%<br>
                        Wind Speed: ${windSpeed} m/sec</p>
                    </div>`;
                }
                else{
                    //bad response from api
                    heading.textContent =`Oops!`;
                    weatherDetails.innerHTML= `
                    <div>
                        <h3>Couldn't fetch data</h3>
                        <p>Please enter a valid country</p>
                    </div>`;
                    console.log("Couldn't fetch data");
                }
            }catch(error){
                console.log("Couldn't fetch weather details: ",error);                
            }
        }
        //convert country to longitude and latitude
        async function countryToLongLat(country){
            const api1 = 'YOUR_OPENCAGE_API_KEY';
            const url=`https://api.opencagedata.com/geocode/v1/json?q=${country}&key=${api1}`;
            try{
                const heading = document.getElementById('heading');
                const weatherDetails = document.getElementById('weatherDetails');
                const response = await fetch(url);
                //console.log(response);
                if(response.ok){
                    const data = await response.json();
                    //console.log("Full response:", data);
                    const result = data.results[0];
                    if (result && result.geometry) {
                        const lat = result.geometry.lat;
                        const lng = result.geometry.lng;
                        //console.log(`${country} ‚Üí Lat: ${lat}, Lng: ${lng}`);
                        weather(lat,lng,country);
                    } else {
                        //if lat/long don't exist 
                        heading.textContent =`Oops!`;
                        weatherDetails.innerHTML= `
                        <div>
                            <h3>Couldn't fetch data</h3>
                            <p>Please enter a valid country</p>
                        </div>`;
                        console.log("No geometry found for the country.");
                    }
                }
                else{
                    //if response is not generated
                    heading.textContent =`Oops!`;
                    weatherDetails.innerHTML= `
                    <div>
                        <h3>Couldn't fetch data</h3>
                        <p>Please enter a valid country</p>
                    </div>`;
                    console.log("Couldn't fetch data");
                }
            }catch(error){
                console.log("Couldn't fetch data: ",error);
            }
        }
        //read country from input after search-button is clicked
        function handleSearch(){
            const country = input.value;
            //console.log(country);
            if(country){
                countryToLongLat(country);
            }
            else{
                alert("No country selected!");
            }
        }
    </script>
</body>
</html>
